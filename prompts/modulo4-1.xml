<task>
  <submodule>4.1: Endpoints Básicos do Dashboard</submodule>
  <objective>
    Criar endpoints iniciais do dashboard para fornecer dados básicos de estatísticas e últimas movimentações.
    - Implementar endpoints simples sem cálculos complexos
    - Focar em dados básicos para o dashboard principal
    - Manter estrutura consistente com APIs existentes
    - Preparar base para funcionalidades mais complexas
  </objective>

  <files>
    <!-- ROTAS DO DASHBOARD -->
    <file type="backend">
      <path>routes/dashboardRoutes.js</path>
      <purpose>Definir rotas básicas do dashboard</purpose>
      <requirements>
        - GET /api/dashboard/stats - Retornar estatísticas básicas do sistema
        - GET /api/dashboard/ultimas-movimentacoes - Retornar últimas movimentações
        - Aplicar middleware requireAuth em todas as rotas
        - Manter mesma estrutura de rotas existentes no sistema
        - Usar controladores do dashboardController
      </requirements>
    </file>

    <!-- CONTROLADOR DO DASHBOARD -->
    <file type="backend">
      <path>controllers/dashboardController.js</path>
      <purpose>Controlador para endpoints básicos do dashboard</purpose>
      <requirements>
        - getStats: retornar estatísticas básicas:
          * total_produtos: contar produtos ativos
          * total_locais: contar locais ativos
          * total_movimentacoes: contar total de movimentações
          * movimentacoes_hoje: contar movimentações do dia atual
        - getUltimasMovimentacoes: retornar últimas 15 movimentações
          * Incluir dados: data, produto_nome, tipo, quantidade, local_origem_nome, local_destino_nome
          * Ordenar por data decrescente
          * Limitar a 15 registros
        - Usar serviços e data layers existentes quando possível
        - Retornar respostas no formato padrão da API
        - Tratar erros com try/catch e retornar status apropriados
      </requirements>
    </file>

    <!-- SERVIÇO BÁSICO DO DASHBOARD -->
    <file type="backend">
      <path>services/dashboardService.js</path>
      <purpose>Serviço para operações básicas do dashboard</purpose>
      <requirements>
        - getEstatisticasBasicas: calcular totais (produtos, locais, movimentações)
        - getUltimasMovimentacoes: buscar últimas movimentações com joins para nomes
        - Usar data layers existentes (produtoData, localData, movimentacaoData)
        - Não implementar cálculos complexos ainda (consumo médio, alertas)
        - Focar em consultas simples de contagem e listagem
      </requirements>
    </file>

    <!-- ATUALIZAÇÃO DO SERVIDOR -->
    <file type="backend">
      <path>server.js</path>
      <purpose>Registrar rotas do dashboard no servidor</purpose>
      <requirements>
        - Importar e usar dashboardRoutes
        - Adicionar após outras rotas de API
        - Manter ordem consistente com outros módulos
      </requirements>
    </file>
  </files>

  <api_endpoints>
    <endpoint>
      <method>GET</method>
      <path>/api/dashboard/stats</path>
      <authentication>Requer autenticação (requireAuth)</authentication>
      <response>
        {
          "success": true,
          "estatisticas": {
            "total_produtos": 45,
            "total_locais": 3,
            "total_movimentacoes": 1280,
            "movimentacoes_hoje": 12
          }
        }
      </response>
    </endpoint>

    <endpoint>
      <method>GET</method>
      <path>/api/dashboard/ultimas-movimentacoes</path>
      <authentication>Requer autenticação (requireAuth)</authentication>
      <response>
        {
          "success": true,
          "movimentacoes": [
            {
              "id": 1,
              "data_movimentacao": "2024-01-15T10:30:00Z",
              "tipo": "Entrada",
              "produto_nome": "Farinha de Trigo",
              "quantidade": 50,
              "local_origem_nome": null,
              "local_destino_nome": "Loja Principal"
            }
          ]
        }
      </response>
    </endpoint>
  </api_endpoints>

  <data_requirements>
    <query>
      <purpose>Estatísticas básicas</purpose>
      <description>
        - COUNT produtos WHERE status = 'Disponível'
        - COUNT locais WHERE status = 'Ativo' 
        - COUNT movimentacoes
        - COUNT movimentacoes WHERE DATE(data_movimentacao) = CURRENT_DATE
      </description>
    </query>

    <query>
      <purpose>Últimas movimentações</purpose>
      <description>
        - SELECT das 15 movimentações mais recentes
        - JOIN com produtos para obter produto_nome
        - JOIN com locais para obter nomes dos locais de origem e destino
        - ORDER BY data_movimentacao DESC
        - LIMIT 15
      </description>
    </query>
  </data_requirements>

  <integration_notes>
    - Reutilizar conexão de banco existente (database.js)
    - Usar mesmo padrão de responses da API (success, data, error)
    - Manter consistência com tratamento de erros existente
    - Seguir mesma estrutura de pastas (routes, controllers, services)
  </integration_notes>

  <dependencies>
    - Módulo 2 implementado (produtos e locais)
    - Módulo 3 implementado (movimentações)
    - Sistema de autenticação funcionando
  </dependencies>

  <testing_focus>
    - Endpoints retornam 200 quando autenticado
    - Endpoints retornam 401 quando não autenticado
    - Estatísticas refletem dados reais do banco
    - Últimas movimentações estão ordenadas corretamente
    - Respostas seguem formato padrão da API
  </testing_focus>

  <next_steps_preparation>
    - Estes endpoints serão usados pelo Sub-módulo 4.6 (Dashboard Frontend)
    - Servirão como base para funcionalidades mais complexas
    - Estrutura permitirá fácil expansão posterior
  </next_steps_preparation>
</task>