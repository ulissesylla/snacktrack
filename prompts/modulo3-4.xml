<task>
  <submodule>3.4: Interface de Entrada de Estoque</submodule>
  <objective>
    Criar a interface para registrar entrada de produtos no estoque.
    - Formulário simples: Produto → Local → Quantidade
    - Integração com a API de movimentações
    - Validações básicas no frontend
    - Feedback com sistema de notificações existente
  </objective>

  <files>
    <!-- PÁGINA DE ENTRADA DE ESTOQUE -->
    <file type="frontend">
      <path>public/entrada-estoque.html</path>
      <purpose>Página para registro de entrada de produtos no estoque</purpose>
      <requirements>
        - Estrutura HTML semântica consistente com outras páginas
        - Título "Registrar Entrada de Estoque"
        - Formulário com campos:
          * Select para Produto (obrigatório) - carregar lista de produtos da API
          * Select para Local (obrigatório) - carregar lista de locais da API
          * Input para Quantidade (obrigatório, número positivo)
        - Botão "Registrar Entrada"
        - Mensagens de feedback para sucesso/erro
        - Link para voltar para a listagem ou página inicial
        - Incluir scripts: auth.js, navbar.js, entradaEstoque.js
        - Usar classes CSS consistentes com o sistema
      </requirements>
    </file>

    <!-- LÓGICA JAVASCRIPT PARA ENTRADA DE ESTOQUE -->
    <file type="frontend">
      <path>public/js/entradaEstoque.js</path>
      <purpose>Lógica do frontend para registro de entrada de estoque</purpose>
      <requirements>
        - Carregar lista de produtos da API /api/produtos (apenas ativos)
        - Carregar lista de locais da API /api/locais (apenas ativos)
        - Preencher selects com dados carregados
        - Validação do formulário no frontend:
          * Produto obrigatório
          * Local obrigatório
          * Quantidade obrigatória, numérica e positiva
        - Submissão do formulário para API /api/movimentacoes/entrada
        - Tratamento de resposta (sucesso/erro)
        - Uso do sistema de notificações (notify.js) para feedback
        - Limpar formulário após sucesso
        - Prevenir submissões duplicadas
        - Integração com sistema de autenticação
      </requirements>
    </file>

    <!-- ATUALIZAÇÃO DO MENU DE NAVEGAÇÃO -->
    <file type="frontend">
      <path>public/index.html</path>
      <purpose>Adicionar entrada de estoque no menu de movimentações</purpose>
      <requirements>
        - No menu "Movimentações" (dropdown), adicionar item "Entrada de Estoque"
        - Link para entrada-estoque.html
        - Manter mesma estilização dos outros itens do menu
      </requirements>
    </file>

    <!-- ATUALIZAÇÃO DO COMPONENTE DE NAVEGAÇÃO -->
    <file type="frontend">
      <path>public/js/navbar.js</path>
      <purpose>Atualizar navegação para incluir entrada de estoque</purpose>
      <requirements>
        - Se houver lógica JavaScript para o menu, atualizar para incluir a nova página
        - Garantir que o item do menu fique ativo quando na página de entrada
      </requirements>
    </file>
  </files>

  <ui_specifications>
    <form_structure>
      - Campo Produto: select com option "Selecione um produto"
      - Campo Local: select com option "Selecione um local" 
      - Campo Quantidade: input type="number" com min="0.01" step="0.01"
      - Botão Registrar: type="submit"
      - Loading state durante o carregamento das listas
      - Loading state durante o envio do formulário
    </form_structure>

    <validation_rules>
      - Produto: obrigatório, deve ser selecionado
      - Local: obrigatório, deve ser selecionado
      - Quantidade: obrigatória, maior que 0
    </validation_rules>

    <api_integration>
      - GET /api/produtos?status=Disponível - carregar produtos
      - GET /api/locais?status=Ativo - carregar locais
      - POST /api/movimentacoes/entrada - registrar entrada
      - Headers: Content-Type: application/json
      - Incluir autenticação via session
    </api_integration>

    <user_experience>
      - Carregar listas automaticamente ao abrir a página
      - Feedback visual durante o carregamento
      - Mensagem de sucesso após registro
      - Redirecionamento opcional ou manter na página para novo registro
      - Validação em tempo real nos campos
    </user_experience>
  </ui_specifications>

  <code_patterns>
    <pattern>Carregamento de Listas</pattern>
    <implementation>
      // Carregar produtos
      async function carregarProdutos() {
        try {
          const response = await fetch('/api/produtos?status=Disponível');
          const data = await response.json();
          preencherSelectProdutos(data);
        } catch (error) {
          notify.error('Erro ao carregar produtos');
        }
      }
    </implementation>

    <pattern>Validação de Formulário</pattern>
    <implementation>
      function validarFormulario(dados) {
        const erros = [];
        if (!dados.produto_id) erros.push('Produto é obrigatório');
        if (!dados.local_id) erros.push('Local é obrigatório');
        if (!dados.quantidade || dados.quantidade <= 0) erros.push('Quantidade deve ser positiva');
        return erros;
      }
    </implementation>

    <pattern>Submissão do Formulário</pattern>
    <implementation>
      async function registrarEntrada(dados) {
        try {
          const response = await fetch('/api/movimentacoes/entrada', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(dados)
          });
          
          if (response.ok) {
            notify.success('Entrada registrada com sucesso!');
            limparFormulario();
          } else {
            const erro = await response.json();
            notify.error(erro.message || 'Erro ao registrar entrada');
          }
        } catch (error) {
          notify.error('Erro de rede ao registrar entrada');
        }
      }
    </implementation>
  </code_patterns>

  <error_handling>
    - Erro de carregamento de produtos/locais: mostrar mensagem e botão para recarregar
    - Erro de validação do formulário: destacar campos inválidos
    - Erro de API (estoque, produto não encontrado etc.): mostrar mensagem específica
    - Erro de rede: mensagem genérica com opção para tentar novamente
  </error_handling>

  <dependencies>
    - Sub-módulo 3.2 implementado (API de movimentações)
    - Módulo 2 implementado (produtos e locais)
    - Sistema de notificações (notify.js) disponível
    - Sistema de autenticação funcionando
  </dependencies>

  <testing_scenarios>
    1. **Carregamento da página**: listas de produtos e locais carregam
    2. **Formulário válido**: submissão funciona e limpa campos
    3. **Formulário inválido**: validações mostram erros
    4. **Produto/Local inativo**: não aparecem nas listas
    5. **Sem autenticação**: redireciona para login
    6. **Erro de API**: mensagem de erro apropriada
    7. **Quantidade decimal**: aceita valores como 0.5, 2.25 etc.
  </testing_scenarios>

  <accessibility>
    - Labels associados corretamente aos inputs
    - Mensagens de erro ligadas aos campos correspondentes
    - Navegação por teclado funcional
    - Focus management adequado
    - Contrastes de cores apropriados
  </accessibility>
</task>